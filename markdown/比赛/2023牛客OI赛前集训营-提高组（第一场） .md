# 2023牛客OI赛前集训营-提高组（第一场）

## 题目列表
- [情景剧](https://ac.nowcoder.com/acm/contest/65192/A)
- [抽卡](https://ac.nowcoder.com/acm/contest/65192/B)
- [虚树](https://ac.nowcoder.com/acm/contest/65192/D)



## 2023牛客OI赛前集训营-提高组（第一场） 情景剧

### 简化题意

有$n$个数$a_i$选择一个区间，使得其最大值乘最小值乘个数最大。输出最大值。

$n \leq 2 \times 10^6$，答案在`unsigned long long`内。

### 题解

数据范围要求我们$O(n)$解决问题。有一个技巧，有多个量的情况下，我们通常枚举其中一个量，再用二分，单调栈，线段树，前缀和等诸如此类的数据结构与算法得出另外两个量的最优解。

对于此题，我们枚举区间最小值，因为最大值是不降的，而人数是上升的，两个变化形式相同更便于我们维护答案。

因为我们枚举的是最小值，那么显然要找到枚举的最小值成立的最大区间（因为区间越大，最大值可能也就越大，而个数也随之上升），考虑使用单调栈。

具体实现上，我们保存每个最小值其区间的最左点减一$l$（$a[l]<a[i]$），其本身的下标，以及最左点到其的区间最大值（左开右闭）。下文分别记作$x$，$y$，$z$。

每加入一个新的数，我们就将大于等于其的栈顶踢出，同时维护其区间最大值$mx=max(mx,st.top().z)$，注意此时$mx$并不包含当前点，计算栈顶贡献$mx*a[t.y]*(i-st.top().x-1)$。踢出结束以后，加入当前点$(t.y,i,max(a[i],mx))$。

值得注意的是，随后要把剩余的栈元素踢出并计算贡献。

[code](https://ac.nowcoder.com/acm/contest/view-submission?submissionId=64274746)